# Vim常用命令

建议参考陈皓的[简明VIM练级攻略](https://coolshell.cn/articles/5426.html)。

> Vim需要大量使用Esc，因此可以使用gnome-tweaks将Caps Lock和Esc交换。
>
> ```shell
> sudo apt-get install gnome-tweaks
> gnome-tweaks
> ```

### 操作模式

* **正常模式`ESC`**：在文件中四处移动光标进行修改。
* **插入模式`i`**：插入文本。
* **替换模式`R`**：替换文本。
* **可视化（一般/行/块）模式`v/V/Ctrl+V`**：选中文本。
* **命令模式`:`**：执行命令。

### 正常模式

#### 移动光标

- 基本移动：`hjkl`（左下上右）
- 词：`w`（下一个词）、`b`（词初）、`e`（词尾）
- 行：`0`（行初）、`$`（行尾）
- 翻页：`Ctrl+u`（上翻半页）、`Ctrl+d`（下翻半页）
- 文件：`gg`（文件头）、`G`（文件尾）

#### 查找

* `/word`：向下查找
* `?word`：向上查找
* `n`：重复上一个向下查找
* `N`：重复上一个向上查找

#### 替换

* `:n1,n2s/word1/word2/g`：将`n1`行到`n2`行的`word1`替换为`word2`
* `:1,$s/word1/word2/g`：将第一行到最后一行 `word1`替换为`word2`
* `:1,$s/word1/word2/gc`：同上，但替换前向用户确认

#### 删除

* `x/X`：向后删除del/向前删除backspace
* `dd`：删除（剪切）光标所在那一行
* `ndd`：删除（剪切）光标所在向下`n`行

#### 复制粘贴

* `yy`：复制光标所在那一行
* `nyy`：复制光标所在向下`n`行
* `p/P`：在光标下一行/上一行粘贴

#### 恢复与重复

* `u`：恢复前一个操作
* `Ctrl+r`：重复前一个操作
* `.`：重复前一个操作

### 插入模式与替换模式

#### 插入模式

* `i/I`：从目前光标所在处插入/在目前所在行的第一个非空格符开始插入
* `a/A`：从目前光标所在下一个字符开始插入/从光标所在行的最后一个字符开始插入
* `Ctrl+o hjkl`：在插入模式下左下上右移动光标

#### 替换模式

* `o/O`：在目前光标所在下一行/上一行插入新的一行
* `r/R`：只替换一次/一直替换，直到按下Esc

### 命令模式

#### 保存与退出

* `:w`：将编辑的数据写入磁盘文件中
* `:q`：退出
* `:wq`：保存后退出

#### 行号

* `:set nu`：显示行号
* `:set nonu`：取消行号

### 可视化模式

* 使用移动命令来选中
* `y`：复制选中部分
* `d`：删除选中部分
* `p`：粘贴复制内容

### 多窗口功能

* `:sp [filename]`：打开一个新窗口，若无`filename`则两个窗口显示同一文件
* `Ctrl+w j/k`：光标移动到下/上一个窗口

### Vim的关键词补全功能

* `Ctrl+x Ctrl+n`：通过当前文件的内容作为关键字进行补充
* `Ctrl+x Ctrl+f`：通过当前目录下文件名作为关键字进行补充
* `Ctrl+x Ctrl+o`：通过当前文件的扩展名作为语法补充

### Vim环境设置与记录

* vim会通过`~/.viminfo`主动记录曾做过的操作。
* vim的设置一般放在`/etc/vim/vimrc`中，不建议修改该文件。
  * 若想修改vim的设置，可以通过创建并修改`~/.vimrc`文件来实现。

### 函数/变量跳转

#### Ctags

* 使用插件`ctags`可以实现函数和变量的跳转

```shell
sudo apt-get install exuberant-ctags
# 在工程目录下生成tags文件
ctags -R .
```

* `Ctrl+]`：跳转
* `Ctrl+T`：跳回
* `gd`：跳转到局部变量定义处
* `gD`：跳转到全局变量定义处，从当前文件开头开始搜索
* `gf`：跳转头文件
* `Ctrl+^`：从跳转的头文件返回
* `%`：移动到匹配的括号，或在`#if`、`#else`、`#endif`间跳转

#### Cscope

* `cscope`比`ctags`更强大，是检索工具。

```shell
# 安装
sudo apt-get install cscope
# 在工程目录下生成索引文件
# -R 递归解析所有子目录
# -b 仅构建数据库cscope.out然后退出，不会进入交互界面
# -q 通过倒排索引加速符号查找过程，会导致额外产生cscope.in.out和cscope.po.out
cscope -Rbq

# 建立和数据库的连接
:cs add cscope.out
# 查看连接的数据库
:cs show

# 查找
# s：查找c符号出现位置
# g：查找定义
# d：查找本函数调用的函数
# c：查找调用本函数的函数
# t：查找字符串
# f：查找并打开文件
# i：查找#include这个文件的文件
:cs find [querytype] [name]
```

* 配置`cscope`可到[官网](http://cscope.sourceforge.net)的配置内容将其内容添加到`~/.vimrc`
